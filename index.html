<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Semakan Ahli Insight</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 600px;
      background: white;
      margin: 50px auto;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    img.logo {
      width: 150px;
      margin-bottom: 10px;
    }

    input {
      width: 80%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      margin-top: 15px;
      padding: 10px 25px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    #result {
      margin-top: 20px;
      text-align: left;
    }

    .summary {
      background: #e9ecef;
      padding: 10px;
      border-radius: 10px;
      margin-top: 15px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container" id="semakContainer">
    <img src="logo.jpg" alt="Logo" class="logo">
    <h2>Semakan Ahli Insight</h2>
    <p>Masukkan Nombor Kad Pengenalan:</p>
    <input type="text" id="inputIC" placeholder="contoh: 900102031234">
    <br>
    <button onclick="semakData()">SEMAK</button>
  </div>

  <div class="container hidden" id="resultContainer">
    <h3 id="nama"></h3>
    <p><strong>No. IC:</strong> <span id="ic"></span></p>
    <p><strong>Plan:</strong> <span id="plan"></span></p>
    <p><strong>No. Telefon:</strong> <span id="phone"></span></p>
    <p><strong>Nama Bank:</strong> <span id="bank"></span></p>
    <p><strong>No. Akaun:</strong> <span id="acc"></span></p>

    <div class="summary" id="summaryBoard"></div>

    <button onclick="kembali()">KEMBALI</button>
  </div>

  <script>
    let data = [];

    async function loadCSV() {
      try {
        const response = await fetch("https://insight-check.onrender.com/sheet-csv");
        const csvText = await response.text();
        console.log("? CSV dimuat:", csvText.length, "aksara");
        data = csvToArray(csvText);
      } catch (error) {
        console.error("? Ralat muat CSV:", error);
      }
    }

    function csvToArray(str) {
      const rows = str.trim().split("\n");
      const headers = rows[0].split(",");
      return rows.slice(1).map(row => {
        const values = row.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h.trim().toUpperCase()] = values[i] ? values[i].trim() : "");
        return obj;
      });
    }

    async function semakData() {
      if (data.length === 0) await loadCSV();
      const icInput = document.getElementById("inputIC").value.replace(/-/g, "");
      const match = data.find(row => (row["NO KAD PENGENALAN"] || "").replace(/-/g, "") === icInput);

      if (match) {
        document.getElementById("semakContainer").classList.add("hidden");
        document.getElementById("resultContainer").classList.remove("hidden");

        document.getElementById("nama").innerText = match["NAMA"] || "-";
        document.getElementById("ic").innerText = match["NO KAD PENGENALAN"] || "-";
        document.getElementById("plan").innerText = match["PLAN"] || "-";
        document.getElementById("phone").innerText = match["NO TELEFON"] || "-";
        document.getElementById("bank").innerText = match["NAMA BANK"] || "-";
        document.getElementById("acc").innerText = match["NO AKAUN"] || "-";

        const summary = document.getElementById("summaryBoard");
        summary.innerHTML = "";
        Object.keys(match).forEach(key => {
          if (!["NAMA","NO KAD PENGENALAN","PLAN","NO TELEFON","NAMA BANK","NO AKAUN"].includes(key) && match[key]) {
            summary.innerHTML += `<p><strong>${key}:</strong> ${match[key]}</p>`;
          }
        });
      } else {
        alert("? Data tidak dijumpai!");
      }
    }

    function kembali() {
      document.getElementById("resultContainer").classList.add("hidden");
      document.getElementById("semakContainer").classList.remove("hidden");
    }
  </script>
</body>
</html>
